{
  "$schema": "https://registry.mercurjs.com/registry-item.json",
  "name": "team-management",
  "description": "Team member management with invitations, roles, and vendor portal pages.",
  "dependencies": [
    "jsonwebtoken",
    "@types/jsonwebtoken",
    "react-jwt"
  ],
  "registryDependencies": [],
  "docs": "## Configuration\n\nAdd the member module to your `medusa-config.ts`:\n\n```ts\nimport { ContainerRegistrationKeys } from \"@medusajs/framework/utils\"\n\nmodules: [\n  {\n    resolve: './modules/member',\n    dependencies: [ContainerRegistrationKeys.QUERY],\n  },\n]\n```\n\n## Middlewares\n\nAdd the team management middlewares to your `api/middlewares.ts`:\n\n```ts\nimport { defineMiddlewares } from \"@medusajs/medusa\";\nimport { vendorMembersMiddlewares } from \"./vendor/members/middlewares\";\nimport { vendorInvitesMiddlewares } from \"./vendor/invites/middlewares\";\n\nexport default defineMiddlewares({\n  routes: [...vendorMembersMiddlewares, ...vendorInvitesMiddlewares],\n});\n```\n\nIf you already have a `middlewares.ts` file, merge the middleware imports and spread them into your existing `routes` array.\n\n## Database Migrations\n\nAfter installing the block and adding the module configuration, generate and run the migrations to create the necessary tables in your database:\n\n```bash\nnpx medusa db:generate member\nnpx medusa db:migrate\n```\n\n## Run codegen\n\nAfter installing the block, regenerate SDK types:\n\n```bash\nnpx @mercurjs/cli@canary codegen\n```",
  "categories": [
    "module",
    "workflow",
    "api",
    "vendor"
  ],
  "files": [
    {
      "path": "team-management/modules/member/index.ts",
      "content": "import { Module } from \"@medusajs/framework/utils\"\n\nimport MemberModuleService from \"./service\"\n\nexport const MEMBER_MODULE = \"member\"\n\nexport * from \"./types\"\nexport { MemberModuleService }\n\nexport default Module(MEMBER_MODULE, {\n  service: MemberModuleService,\n})\n",
      "type": "registry:module"
    },
    {
      "path": "team-management/modules/member/service.ts",
      "content": "import jwt, { JwtPayload } from \"jsonwebtoken\"\n\nimport { ConfigModule } from \"@medusajs/framework\"\nimport { Context } from \"@medusajs/framework/types\"\nimport {\n  InjectTransactionManager,\n  MedusaContext,\n  MedusaError,\n  MedusaService,\n} from \"@medusajs/framework/utils\"\n\nimport { Member } from \"./models/member\"\nimport { MemberInvite } from \"./models/member-invite\"\nimport { CreateMemberInviteDTO, MemberInviteDTO } from \"./types\"\n\nconst MEMBER_MODULE = \"member\"\n\ntype InjectedDependencies = {\n  configModule: ConfigModule\n}\n\n// 7 days in ms\nconst DEFAULT_VALID_INVITE_DURATION = 1000 * 60 * 60 * 24 * 7\n\nclass MemberModuleService extends MedusaService({\n  Member,\n  MemberInvite,\n}) {\n  private readonly httpConfig_: ConfigModule[\"projectConfig\"][\"http\"]\n  private readonly validInviteDuration_: number\n\n  constructor({ configModule }: InjectedDependencies) {\n    super(...arguments)\n\n    this.httpConfig_ = configModule.projectConfig.http\n\n    const moduleDef = configModule.modules?.[MEMBER_MODULE]\n    const options =\n      typeof moduleDef !== \"boolean\"\n        ? (moduleDef?.options as { validInviteDuration?: number })\n        : null\n\n    this.validInviteDuration_ =\n      options?.validInviteDuration ?? DEFAULT_VALID_INVITE_DURATION\n  }\n\n  async validateInviteToken(token: string) {\n    const jwtSecret = this.httpConfig_.jwtSecret as string\n    const decoded: JwtPayload = jwt.verify(token, jwtSecret, {\n      complete: true,\n    })\n\n    const invite = await this.retrieveMemberInvite(decoded.payload.id, {})\n\n    if (invite.accepted) {\n      throw new MedusaError(\n        MedusaError.Types.INVALID_DATA,\n        \"The invite has already been accepted\"\n      )\n    }\n\n    if (invite.expires_at < new Date()) {\n      throw new MedusaError(\n        MedusaError.Types.INVALID_DATA,\n        \"The invite has expired\"\n      )\n    }\n\n    return invite\n  }\n\n  @InjectTransactionManager()\n  // @ts-expect-error: createMemberInvites method already exists in base\n  async createMemberInvites(\n    input: CreateMemberInviteDTO | CreateMemberInviteDTO[],\n    @MedusaContext() sharedContext: Context = {}\n  ): Promise<MemberInviteDTO[]> {\n    const data = Array.isArray(input) ? input : [input]\n\n    const expires_at = new Date()\n    expires_at.setMilliseconds(\n      new Date().getMilliseconds() + DEFAULT_VALID_INVITE_DURATION\n    )\n\n    const toCreate = data.map((invite) => {\n      return {\n        ...invite,\n        expires_at: new Date(),\n        token: \"placeholder\",\n      }\n    })\n\n    const created = await super.createMemberInvites(toCreate, sharedContext)\n    const toUpdate = Array.isArray(created) ? created : [created]\n\n    const updates = toUpdate.map((invite) => {\n      return {\n        ...invite,\n        id: invite.id,\n        expires_at,\n        token: this.generateToken({ id: invite.id }),\n      }\n    })\n\n    await this.updateMemberInvites(updates, sharedContext)\n\n    return updates\n  }\n\n  private generateToken(data: { id: string }): string {\n    const jwtSecret = this.httpConfig_.jwtSecret as string\n    return jwt.sign(data, jwtSecret, {\n      expiresIn: this.validInviteDuration_ / 1000,\n    })\n  }\n}\n\nexport default MemberModuleService\n",
      "type": "registry:module"
    },
    {
      "path": "team-management/modules/member/types.ts",
      "content": "export type MemberRole = \"owner\" | \"admin\" | \"member\"\n\nexport const MemberRole = {\n  OWNER: \"owner\",\n  ADMIN: \"admin\",\n  MEMBER: \"member\",\n} as const\n\nexport type CreateMemberDTO = {\n  seller_id: string\n  name: string\n  email?: string\n  role?: MemberRole\n  bio?: string\n  phone?: string\n  photo?: string\n}\n\nexport type UpdateMemberDTO = {\n  id: string\n  name?: string\n  bio?: string\n  phone?: string\n  photo?: string\n}\n\nexport type CreateMemberInviteDTO = {\n  email: string\n  role?: MemberRole\n  seller_id: string\n}\n\nexport type UpdateMemberInviteDTO = {\n  id: string\n  accepted?: boolean\n}\n\nexport type AcceptMemberInviteDTO = {\n  token: string\n  name: string\n}\n\nexport type MemberDTO = {\n  id: string\n  role: MemberRole\n  name: string\n  email: string | null\n  bio: string | null\n  phone: string | null\n  photo: string | null\n  seller_id: string\n}\n\nexport type MemberInviteDTO = {\n  id: string\n  email: string\n  role: MemberRole\n  token: string\n  expires_at: Date | string\n  accepted: boolean\n  seller_id: string\n}\n\nexport type VendorMemberListResponse = {\n  members: MemberDTO[]\n  count: number\n  offset: number\n  limit: number\n}\n\nexport type VendorMemberResponse = {\n  member: MemberDTO\n}\n\nexport type VendorMemberInviteListResponse = {\n  invites: MemberInviteDTO[]\n  count: number\n  offset: number\n  limit: number\n}\n\nexport type VendorMemberInviteResponse = {\n  invite: MemberInviteDTO\n}\n",
      "type": "registry:module"
    },
    {
      "path": "team-management/modules/member/models/member.ts",
      "content": "import { model } from \"@medusajs/framework/utils\"\n\nexport const Member = model.define(\"member\", {\n  id: model.id({ prefix: \"mem\" }).primaryKey(),\n  seller_id: model.text(),\n  role: model.enum([\"owner\", \"admin\", \"member\"]).default(\"owner\"),\n  name: model.text().searchable(),\n  email: model.text().nullable(),\n  bio: model.text().searchable().nullable(),\n  phone: model.text().searchable().nullable(),\n  photo: model.text().nullable(),\n})\n",
      "type": "registry:module"
    },
    {
      "path": "team-management/modules/member/models/member-invite.ts",
      "content": "import { model } from \"@medusajs/framework/utils\"\n\nexport const MemberInvite = model.define(\"member_invite\", {\n  id: model.id({ prefix: \"meminv\" }).primaryKey(),\n  seller_id: model.text(),\n  email: model.text(),\n  role: model.enum([\"owner\", \"admin\", \"member\"]).default(\"owner\"),\n  token: model.text(),\n  expires_at: model.dateTime(),\n  accepted: model.boolean().default(false),\n})\n",
      "type": "registry:module"
    },
    {
      "path": "team-management/workflows/member/steps/create-member.ts",
      "content": "import { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { CreateMemberDTO, MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const createMemberStep = createStep(\n  \"create-member\",\n  async (input: CreateMemberDTO, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const member = await service.createMembers(input)\n\n    return new StepResponse(member, member.id)\n  },\n  async (memberId: string | undefined, { container }) => {\n    if (!memberId) return\n\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await service.deleteMembers([memberId])\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/steps/update-member.ts",
      "content": "import { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { UpdateMemberDTO, MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const updateMemberStep = createStep(\n  \"update-member\",\n  async (input: UpdateMemberDTO, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const previousData = await service.retrieveMember(input.id)\n\n    const updatedMember = await service.updateMembers(input)\n\n    return new StepResponse(updatedMember, previousData)\n  },\n  async (previousData, { container }) => {\n    if (!previousData) return\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await service.updateMembers(previousData)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/steps/delete-member.ts",
      "content": "import { MedusaError } from \"@medusajs/framework/utils\"\nimport { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { MemberRole, MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const deleteMemberStep = createStep(\n  \"delete-member\",\n  async (id: string, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const member = await service.retrieveMember(id)\n\n    if (member.role === MemberRole.OWNER) {\n      throw new MedusaError(\n        MedusaError.Types.INVALID_DATA,\n        \"Owner member cannot be deleted\"\n      )\n    }\n\n    await service.softDeleteMembers(id)\n\n    return new StepResponse(id)\n  },\n  async (memberId: string | undefined, { container }) => {\n    if (!memberId) return\n\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await service.restoreMembers(memberId)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/steps/create-member-invite.ts",
      "content": "import { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { CreateMemberInviteDTO, MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const createMemberInviteStep = createStep(\n  \"create-member-invite\",\n  async (input: CreateMemberInviteDTO, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const [memberInvite] = await service.createMemberInvites(input)\n\n    return new StepResponse(memberInvite, memberInvite?.id ?? \"\")\n  },\n  async (memberInviteId: string | undefined, { container }) => {\n    if (!memberInviteId) return\n\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await service.deleteMemberInvites([memberInviteId as string])\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/steps/validate-member-invite.ts",
      "content": "import { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { AcceptMemberInviteDTO, MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const validateMemberInviteStep = createStep(\n  \"validate-member-invite\",\n  async (input: AcceptMemberInviteDTO, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const invite = await service.validateInviteToken(input.token)\n\n    return new StepResponse(invite)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/steps/update-member-invite.ts",
      "content": "import { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { UpdateMemberInviteDTO, MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const updateMemberInviteStep = createStep(\n  \"update-member-invite\",\n  async (input: UpdateMemberInviteDTO, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const previousData = await service.retrieveMemberInvite(input.id)\n\n    const updatedInvites = await service.updateMemberInvites(input)\n\n    return new StepResponse(updatedInvites, previousData)\n  },\n  async (previousData: Record<string, unknown> | undefined, { container }) => {\n    if (!previousData) return\n\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n    await service.updateMemberInvites(previousData)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/steps/delete-member-invite.ts",
      "content": "import { StepResponse, createStep } from \"@medusajs/framework/workflows-sdk\"\n\nimport { MEMBER_MODULE, MemberModuleService } from \"../../../modules/member\"\n\nexport const deleteMemberInvitesStep = createStep(\n  \"delete-member-invite\",\n  async (id: string, { container }) => {\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await service.softDeleteMemberInvites(id)\n\n    return new StepResponse(id)\n  },\n  async (inviteId: string | undefined, { container }) => {\n    if (!inviteId) return\n\n    const service = container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await service.restoreMemberInvites(inviteId)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/workflows/invite-member.ts",
      "content": "import { WorkflowResponse, createWorkflow, transform } from \"@medusajs/framework/workflows-sdk\"\nimport { createRemoteLinkStep } from \"@medusajs/medusa/core-flows\"\n\nimport { CreateMemberInviteDTO } from \"../../../modules/member\"\nimport { createMemberInviteStep } from \"../steps/create-member-invite\"\n\nexport const inviteMemberWorkflow = createWorkflow(\n  \"invite-member\",\n  function (input: CreateMemberInviteDTO) {\n    const invite = createMemberInviteStep(input)\n\n    const link = transform({ invite, input }, (data) => [{\n      seller: {\n        seller_id: data.input.seller_id,\n      },\n      member: {\n        member_invite_id: data.invite.id,\n      },\n    }])\n\n    createRemoteLinkStep(link)\n\n    return new WorkflowResponse(invite)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/workflows/accept-member-invite.ts",
      "content": "import { parallelize } from \"@medusajs/framework/workflows-sdk\"\nimport { setAuthAppMetadataStep } from \"@medusajs/medusa/core-flows\"\nimport { WorkflowResponse, createWorkflow } from \"@medusajs/framework/workflows-sdk\"\n\nimport { AcceptMemberInviteDTO } from \"../../../modules/member\"\nimport { createMemberStep } from \"../steps/create-member\"\nimport { updateMemberInviteStep } from \"../steps/update-member-invite\"\nimport { validateMemberInviteStep } from \"../steps/validate-member-invite\"\n\ntype AcceptMemberInviteWorkflowInput = {\n  invite: AcceptMemberInviteDTO\n  authIdentityId: string\n}\n\nexport const acceptMemberInviteWorkflow = createWorkflow(\n  \"accept-member-invite\",\n  function (input: AcceptMemberInviteWorkflowInput) {\n    const invite = validateMemberInviteStep(input.invite)\n\n    const [member] = parallelize(\n      createMemberStep({\n        seller_id: invite.seller_id,\n        name: input.invite.name,\n        role: invite.role,\n        email: invite.email,\n      }),\n      updateMemberInviteStep({\n        id: invite.id,\n        accepted: true,\n      })\n    )\n\n    // link seller to auth identity\n    setAuthAppMetadataStep({\n      authIdentityId: input.authIdentityId,\n      actorType: \"seller\",\n      value: member.seller_id,\n    }).config({\n      name: \"link-seller-to-auth-identity\",\n    })\n\n    // link member to auth identity\n    setAuthAppMetadataStep({\n      authIdentityId: input.authIdentityId,\n      actorType: \"member\",\n      value: member.id,\n    }).config({\n      name: \"link-member-to-auth-identity\",\n    })\n\n    return new WorkflowResponse(invite)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/workflows/update-member.ts",
      "content": "import { WorkflowResponse, createWorkflow } from \"@medusajs/framework/workflows-sdk\"\n\nimport { UpdateMemberDTO } from \"../../../modules/member\"\nimport { updateMemberStep } from \"../steps/update-member\"\n\nexport const updateMemberWorkflow = createWorkflow(\n  \"update-member\",\n  function (input: UpdateMemberDTO) {\n    return new WorkflowResponse(updateMemberStep(input))\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/workflows/delete-member.ts",
      "content": "import { createWorkflow } from \"@medusajs/framework/workflows-sdk\"\n\nimport { deleteMemberStep } from \"../steps/delete-member\"\n\nexport const deleteMemberWorkflow = createWorkflow(\n  \"delete-member\",\n  function (id: string) {\n    deleteMemberStep(id)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/member/workflows/delete-member-invite.ts",
      "content": "import { createWorkflow } from \"@medusajs/framework/workflows-sdk\"\n\nimport { deleteMemberInvitesStep } from \"../steps/delete-member-invite\"\n\nexport const deleteMemberInviteWorkflow = createWorkflow(\n  \"delete-member-invite\",\n  function (id: string) {\n    deleteMemberInvitesStep(id)\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/workflows/hooks/seller-created.ts",
      "content": "import { StepResponse } from \"@medusajs/framework/workflows-sdk\"\nimport { Modules } from \"@medusajs/framework/utils\"\nimport { IAuthModuleService } from \"@medusajs/framework/types\"\n\nimport { createSellerWorkflow } from \"@mercurjs/core-plugin/workflows\"\nimport { MEMBER_MODULE, MemberModuleService } from \"../../modules/member\"\n\ncreateSellerWorkflow.hooks.sellerCreated(\n  async ({ seller, auth_identity_id }, { container }) => {\n    const memberService =\n      container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    const member = await memberService.createMembers({\n      seller_id: seller.id,\n      name: seller.name,\n      role: \"owner\",\n    })\n\n    const authModule =\n      container.resolve<IAuthModuleService>(Modules.AUTH)\n\n    const authIdentity = await authModule.retrieveAuthIdentity(auth_identity_id)\n\n    await authModule.updateAuthIdentities({\n      id: auth_identity_id,\n      app_metadata: {\n        ...authIdentity.app_metadata,\n        member_id: member.id,\n      },\n    })\n\n    return new StepResponse(member, {\n      member_id: member.id,\n      auth_identity_id,\n      previous_app_metadata: authIdentity.app_metadata,\n    })\n  },\n  async (data, { container }) => {\n    if (!data) return\n\n    const memberService =\n      container.resolve<MemberModuleService>(MEMBER_MODULE)\n\n    await memberService.deleteMembers([data.member_id])\n\n    const authModule =\n      container.resolve<IAuthModuleService>(Modules.AUTH)\n\n    await authModule.updateAuthIdentities({\n      id: data.auth_identity_id,\n      app_metadata: data.previous_app_metadata,\n    })\n  }\n)\n",
      "type": "registry:workflow"
    },
    {
      "path": "team-management/api/vendor/members/helpers.ts",
      "content": "import {\n  AuthenticatedMedusaRequest,\n  MedusaNextFunction,\n  MedusaResponse,\n} from \"@medusajs/framework/http\"\nimport { MedusaContainer } from \"@medusajs/framework/types\"\nimport {\n  ContainerRegistrationKeys,\n  MedusaError,\n} from \"@medusajs/framework/utils\"\n\nexport const applySellerMemberFilter = (\n  req: AuthenticatedMedusaRequest,\n  _res: MedusaResponse,\n  next: MedusaNextFunction\n) => {\n  req.filterableFields.seller_id = req.auth_context.actor_id\n  next()\n}\n\nexport const validateSellerMember = async (\n  scope: MedusaContainer,\n  sellerId: string,\n  memberId: string\n) => {\n  const query = scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  const {\n    data: [member],\n  } = await query.graph({\n    entity: \"member\",\n    filters: {\n      id: memberId,\n      seller_id: sellerId,\n    },\n    fields: [\"id\"],\n  })\n\n  if (!member) {\n    throw new MedusaError(\n      MedusaError.Types.NOT_FOUND,\n      `Member with id: ${memberId} was not found`\n    )\n  }\n}\n\nexport const fetchSellerByAuthActorId = async (\n  authActorId: string,\n  scope: MedusaContainer,\n  fields: string[] = [\"id\"]\n) => {\n  const query = scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  const {\n    data: [seller],\n  } = await query.graph({\n    entity: \"seller\",\n    filters: { id: authActorId },\n    fields,\n  })\n\n  return seller\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/members/query-config.ts",
      "content": "export const vendorMemberFields = [\n  \"id\",\n  \"email\",\n  \"role\",\n  \"name\",\n  \"bio\",\n  \"phone\",\n  \"photo\",\n  \"seller_id\",\n]\n\nexport const vendorMemberQueryConfig = {\n  list: {\n    defaults: vendorMemberFields,\n    isList: true,\n  },\n  retrieve: {\n    defaults: vendorMemberFields,\n    isList: false,\n  },\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/members/validators.ts",
      "content": "import { z } from \"zod\"\n\nimport { createFindParams } from \"@medusajs/medusa/api/utils/validators\"\n\nexport type VendorGetMemberParamsType = z.infer<typeof VendorGetMemberParams>\nexport const VendorGetMemberParams = createFindParams({\n  offset: 0,\n  limit: 50,\n}).merge(\n  z.object({\n    q: z.string().optional(),\n  })\n)\n\nexport type VendorUpdateMemberType = z.infer<typeof VendorUpdateMember>\nexport const VendorUpdateMember = z\n  .object({\n    name: z.string().optional(),\n    bio: z.string().optional(),\n    phone: z.string().optional(),\n    photo: z.string().optional(),\n  })\n  .strict()\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/members/middlewares.ts",
      "content": "import {\n  validateAndTransformBody,\n  validateAndTransformQuery,\n} from \"@medusajs/framework\"\nimport { MiddlewareRoute } from \"@medusajs/framework/http\"\n\nimport { applySellerMemberFilter } from \"./helpers\"\nimport { vendorMemberQueryConfig } from \"./query-config\"\nimport { VendorGetMemberParams, VendorUpdateMember } from \"./validators\"\n\nexport const vendorMembersMiddlewares: MiddlewareRoute[] = [\n  {\n    method: [\"GET\"],\n    matcher: \"/vendor/members/me\",\n    middlewares: [\n      validateAndTransformQuery(\n        VendorGetMemberParams,\n        vendorMemberQueryConfig.retrieve\n      ),\n    ],\n  },\n  {\n    method: [\"GET\"],\n    matcher: \"/vendor/members\",\n    middlewares: [\n      validateAndTransformQuery(\n        VendorGetMemberParams,\n        vendorMemberQueryConfig.list\n      ),\n      applySellerMemberFilter,\n    ],\n  },\n  {\n    method: [\"GET\"],\n    matcher: \"/vendor/members/:id\",\n    middlewares: [\n      validateAndTransformQuery(\n        VendorGetMemberParams,\n        vendorMemberQueryConfig.retrieve\n      ),\n    ],\n  },\n  {\n    method: [\"POST\"],\n    matcher: \"/vendor/members/:id\",\n    middlewares: [\n      validateAndTransformQuery(\n        VendorGetMemberParams,\n        vendorMemberQueryConfig.retrieve\n      ),\n      validateAndTransformBody(VendorUpdateMember),\n    ],\n  },\n  {\n    method: [\"DELETE\"],\n    matcher: \"/vendor/members/:id\",\n    middlewares: [\n    ],\n  },\n]\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/members/route.ts",
      "content": "import {\n  AuthenticatedMedusaRequest,\n  MedusaResponse,\n} from \"@medusajs/framework\"\nimport { ContainerRegistrationKeys } from \"@medusajs/framework/utils\"\n\nimport { VendorMemberListResponse } from \"../../../modules/member\"\n\nexport const GET = async (\n  req: AuthenticatedMedusaRequest,\n  res: MedusaResponse<VendorMemberListResponse>\n) => {\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  const { data: members, metadata } = await query.graph({\n    entity: \"member\",\n    fields: req.queryConfig.fields,\n    filters: req.filterableFields,\n    pagination: req.queryConfig.pagination,\n  })\n\n  res.json({\n    members,\n    count: metadata?.count ?? 0,\n    offset: metadata?.skip ?? 0,\n    limit: metadata?.take ?? 0,\n  })\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/members/[id]/route.ts",
      "content": "import {\n  AuthenticatedMedusaRequest,\n  MedusaResponse,\n} from \"@medusajs/framework\"\nimport { ContainerRegistrationKeys } from \"@medusajs/framework/utils\"\n\nimport { VendorMemberResponse } from \"../../../../modules/member\"\nimport { deleteMemberWorkflow } from \"../../../../workflows/member/workflows/delete-member\"\nimport { updateMemberWorkflow } from \"../../../../workflows/member/workflows/update-member\"\nimport { validateSellerMember } from \"../helpers\"\nimport { VendorUpdateMemberType } from \"../validators\"\n\nexport const GET = async (\n  req: AuthenticatedMedusaRequest,\n  res: MedusaResponse<VendorMemberResponse>\n) => {\n  const { id } = req.params\n  await validateSellerMember(req.scope, req.auth_context.actor_id, id!)\n\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n  const {\n    data: [member],\n  } = await query.graph(\n    {\n      entity: \"member\",\n      fields: req.queryConfig.fields,\n      filters: { id },\n    },\n    { throwIfKeyNotFound: true }\n  )\n\n  res.json({ member })\n}\n\nexport const POST = async (\n  req: AuthenticatedMedusaRequest<VendorUpdateMemberType>,\n  res: MedusaResponse<VendorMemberResponse>\n) => {\n  const { id } = req.params\n  await validateSellerMember(req.scope, req.auth_context.actor_id, id!)\n\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  await updateMemberWorkflow(req.scope).run({\n    input: {\n      id: id!,\n      ...req.validatedBody,\n    },\n  })\n\n  const {\n    data: [member],\n  } = await query.graph(\n    {\n      entity: \"member\",\n      fields: req.queryConfig.fields,\n      filters: { id },\n    },\n    { throwIfKeyNotFound: true }\n  )\n\n  res.json({ member })\n}\n\nexport const DELETE = async (\n  req: AuthenticatedMedusaRequest,\n  res: MedusaResponse\n) => {\n  const { id } = req.params\n  await validateSellerMember(req.scope, req.auth_context.actor_id, id!)\n\n  await deleteMemberWorkflow(req.scope).run({\n    input: id,\n  })\n\n  res.json({\n    id,\n    object: \"member\",\n    deleted: true,\n  })\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/members/me/route.ts",
      "content": "import {\n  AuthenticatedMedusaRequest,\n  MedusaResponse,\n} from \"@medusajs/framework\"\nimport { ContainerRegistrationKeys } from \"@medusajs/framework/utils\"\n\nimport { VendorMemberResponse } from \"../../../../modules/member\"\n\nexport const GET = async (\n  req: AuthenticatedMedusaRequest,\n  res: MedusaResponse<VendorMemberResponse>\n) => {\n  const memberId = req.auth_context.app_metadata.member_id as string\n\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n  const {\n    data: [member],\n  } = await query.graph(\n    {\n      entity: \"member\",\n      fields: req.queryConfig.fields,\n      filters: { id: memberId },\n    },\n    { throwIfKeyNotFound: true }\n  )\n\n  res.json({ member })\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/invites/query-config.ts",
      "content": "export const vendorMemberInviteFields = [\n  \"id\",\n  \"email\",\n  \"role\",\n  \"expires_at\",\n  \"accepted\",\n  \"seller_id\",\n]\n\nexport const vendorMemberInviteQueryConfig = {\n  list: {\n    defaults: vendorMemberInviteFields,\n    isList: true,\n  },\n  retrieve: {\n    defaults: vendorMemberInviteFields,\n    isList: false,\n  },\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/invites/validators.ts",
      "content": "import { z } from \"zod\"\n\nimport { createFindParams } from \"@medusajs/medusa/api/utils/validators\"\n\nexport type VendorGetMemberInviteParamsType = z.infer<\n  typeof VendorGetMemberInviteParams\n>\nexport const VendorGetMemberInviteParams = createFindParams({\n  offset: 0,\n  limit: 50,\n})\n\nexport type VendorInviteMemberType = z.infer<typeof VendorInviteMember>\nexport const VendorInviteMember = z\n  .object({\n    email: z.string().email(),\n    role: z.enum([\"owner\", \"admin\", \"member\"]),\n  })\n  .strict()\n\nexport type VendorAcceptMemberInviteType = z.infer<\n  typeof VendorAcceptMemberInvite\n>\nexport const VendorAcceptMemberInvite = z\n  .object({\n    token: z.string(),\n    name: z.string(),\n  })\n  .strict()\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/invites/middlewares.ts",
      "content": "import {\n  authenticate,\n  validateAndTransformBody,\n  validateAndTransformQuery,\n} from \"@medusajs/framework\"\nimport {\n  AuthenticatedMedusaRequest,\n  MedusaNextFunction,\n  MedusaResponse,\n  MiddlewareRoute,\n} from \"@medusajs/framework/http\"\n\nimport { vendorMemberInviteQueryConfig } from \"./query-config\"\nimport {\n  VendorAcceptMemberInvite,\n  VendorGetMemberInviteParams,\n  VendorInviteMember,\n} from \"./validators\"\n\nconst applySellerInviteFilter = (\n  req: AuthenticatedMedusaRequest,\n  _res: MedusaResponse,\n  next: MedusaNextFunction\n) => {\n  req.filterableFields.seller_id = req.auth_context.actor_id\n  next()\n}\n\nexport const vendorInvitesMiddlewares: MiddlewareRoute[] = [\n  {\n    method: [\"GET\"],\n    matcher: \"/vendor/invites\",\n    middlewares: [\n      validateAndTransformQuery(\n        VendorGetMemberInviteParams,\n        vendorMemberInviteQueryConfig.list\n      ),\n      applySellerInviteFilter,\n    ],\n  },\n  {\n    method: [\"POST\"],\n    matcher: \"/vendor/invites\",\n    middlewares: [\n      validateAndTransformBody(VendorInviteMember),\n      validateAndTransformQuery(\n        VendorGetMemberInviteParams,\n        vendorMemberInviteQueryConfig.retrieve\n      ),\n    ],\n  },\n  {\n    method: [\"POST\"],\n    matcher: \"/vendor/invites/accept\",\n    middlewares: [\n      authenticate(\"seller\", [\"bearer\", \"session\"], {\n        allowUnregistered: true,\n      }),\n      validateAndTransformBody(VendorAcceptMemberInvite),\n      validateAndTransformQuery(\n        VendorGetMemberInviteParams,\n        vendorMemberInviteQueryConfig.retrieve\n      ),\n    ],\n  },\n]\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/invites/route.ts",
      "content": "import {\n  AuthenticatedMedusaRequest,\n  MedusaResponse,\n} from \"@medusajs/framework\"\nimport { ContainerRegistrationKeys } from \"@medusajs/framework/utils\"\n\nimport { VendorMemberInviteListResponse, VendorMemberInviteResponse } from \"../../../modules/member\"\nimport { inviteMemberWorkflow } from \"../../../workflows/member/workflows/invite-member\"\nimport { VendorInviteMemberType } from \"./validators\"\n\nexport const POST = async (\n  req: AuthenticatedMedusaRequest<VendorInviteMemberType>,\n  res: MedusaResponse<VendorMemberInviteResponse>\n) => {\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  // actor_id IS seller_id (set by core-plugin auth)\n  const sellerId = req.auth_context.actor_id\n\n  const { result: created } = await inviteMemberWorkflow(req.scope).run({\n    input: {\n      ...req.validatedBody,\n      seller_id: sellerId,\n    },\n  })\n\n  const {\n    data: [invite],\n  } = await query.graph(\n    {\n      entity: \"member_invite\",\n      fields: req.queryConfig.fields,\n      filters: { id: created.id },\n    },\n    { throwIfKeyNotFound: true }\n  )\n\n  res.status(201).json({ invite })\n}\n\nexport const GET = async (\n  req: AuthenticatedMedusaRequest,\n  res: MedusaResponse<VendorMemberInviteListResponse>\n) => {\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  const { data: invites, metadata } = await query.graph({\n    entity: \"member_invite\",\n    fields: req.queryConfig.fields,\n    filters: req.filterableFields,\n    pagination: req.queryConfig.pagination,\n  })\n\n  res.json({\n    invites,\n    count: metadata?.count ?? 0,\n    offset: metadata?.skip ?? 0,\n    limit: metadata?.take ?? 0,\n  })\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/api/vendor/invites/accept/route.ts",
      "content": "import {\n  AuthenticatedMedusaRequest,\n  MedusaResponse,\n} from \"@medusajs/framework\"\nimport { ContainerRegistrationKeys } from \"@medusajs/framework/utils\"\n\nimport { VendorMemberInviteResponse } from \"../../../../modules/member\"\nimport { acceptMemberInviteWorkflow } from \"../../../../workflows/member/workflows/accept-member-invite\"\nimport { VendorAcceptMemberInviteType } from \"../validators\"\n\nexport const AUTHENTICATE = false\n\nexport const POST = async (\n  req: AuthenticatedMedusaRequest<VendorAcceptMemberInviteType>,\n  res: MedusaResponse<VendorMemberInviteResponse>\n) => {\n  const query = req.scope.resolve(ContainerRegistrationKeys.QUERY)\n\n  const { result } = await acceptMemberInviteWorkflow(req.scope).run({\n    input: {\n      invite: req.validatedBody,\n      authIdentityId: req.auth_context.auth_identity_id,\n    },\n  })\n\n  const {\n    data: [invite],\n  } = await query.graph(\n    {\n      entity: \"member_invite\",\n      fields: req.queryConfig.fields,\n      filters: { id: result.id },\n    },\n    { throwIfKeyNotFound: true }\n  )\n\n  res.json({ invite })\n}\n",
      "type": "registry:api"
    },
    {
      "path": "team-management/vendor/hooks/api/members.tsx",
      "content": "import {\n  useMutation,\n  useQuery,\n  useQueryClient,\n} from \"@tanstack/react-query\"\nimport type { UseMutationOptions, UseQueryOptions } from \"@tanstack/react-query\"\nimport { queryKeysFactory } from \"@mercurjs/dashboard-shared\"\nimport { client } from \"../../lib/client\"\nimport type { ClientError, InferClientInput, InferClientOutput } from \"@mercurjs/client\"\n\nconst MEMBERS_QUERY_KEY = \"vendor_members\" as const\nexport const membersQueryKeys = queryKeysFactory(MEMBERS_QUERY_KEY)\n\nexport type MemberDTO = InferClientOutput<\n  typeof client.vendor.members.$id.query\n>[\"member\"]\n\nexport const useMembers = (\n  query?: InferClientInput<typeof client.vendor.members.query>,\n  options?: Omit<\n    UseQueryOptions<\n      unknown,\n      ClientError,\n      InferClientOutput<typeof client.vendor.members.query>\n    >,\n    \"queryKey\" | \"queryFn\"\n  >\n) => {\n  const { data, ...rest } = useQuery({\n    queryKey: membersQueryKeys.list(query),\n    queryFn: async () =>\n      client.vendor.members.query({\n        ...query,\n      }),\n    ...options,\n  })\n\n  return { ...data, ...rest }\n}\n\nexport const useMember = (\n  id: string,\n  query?: InferClientInput<typeof client.vendor.members.$id.query>,\n  options?: Omit<\n    UseQueryOptions<\n      unknown,\n      ClientError,\n      InferClientOutput<typeof client.vendor.members.$id.query>\n    >,\n    \"queryKey\" | \"queryFn\"\n  >\n) => {\n  const { data, ...rest } = useQuery({\n    queryKey: membersQueryKeys.detail(id, query),\n    queryFn: async () =>\n      client.vendor.members.$id.query({\n        $id: id,\n        ...query,\n      }),\n    ...options,\n  })\n\n  return { ...data, ...rest }\n}\n\nexport const useUpdateMember = (\n  id: string,\n  options?: UseMutationOptions<\n    InferClientOutput<typeof client.vendor.members.$id.mutate>,\n    ClientError,\n    Omit<InferClientInput<typeof client.vendor.members.$id.mutate>, \"$id\">\n  >\n) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: async (payload) =>\n      client.vendor.members.$id.mutate({\n        ...payload,\n        $id: id,\n      }),\n    onSuccess: (data, variables, context) => {\n      queryClient.invalidateQueries({\n        queryKey: membersQueryKeys.detail(id),\n      })\n      queryClient.invalidateQueries({\n        queryKey: membersQueryKeys.lists(),\n      })\n      options?.onSuccess?.(data, variables, context)\n    },\n    ...options,\n  })\n}\n\nexport const useDeleteMember = (\n  id: string,\n  options?: UseMutationOptions<\n    InferClientOutput<typeof client.vendor.members.$id.delete>,\n    ClientError\n  >\n) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: async () =>\n      client.vendor.members.$id.delete({\n        $id: id,\n      }),\n    onSuccess: (data, variables, context) => {\n      queryClient.invalidateQueries({\n        queryKey: membersQueryKeys.detail(id),\n      })\n      queryClient.invalidateQueries({\n        queryKey: membersQueryKeys.lists(),\n      })\n      options?.onSuccess?.(data, variables, context)\n    },\n    ...options,\n  })\n}\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/hooks/api/invites.tsx",
      "content": "import {\n  useMutation,\n  useQuery,\n  useQueryClient,\n} from \"@tanstack/react-query\"\nimport type { UseMutationOptions, UseQueryOptions } from \"@tanstack/react-query\"\nimport { queryKeysFactory } from \"@mercurjs/dashboard-shared\"\nimport { client } from \"../../lib/client\"\nimport type { ClientError, InferClientInput, InferClientOutput } from \"@mercurjs/client\"\n\nconst INVITES_QUERY_KEY = \"vendor_invites\" as const\nexport const invitesQueryKeys = queryKeysFactory(INVITES_QUERY_KEY)\n\nexport const useInvites = (\n  query?: InferClientInput<typeof client.vendor.invites.query>,\n  options?: Omit<\n    UseQueryOptions<\n      unknown,\n      ClientError,\n      InferClientOutput<typeof client.vendor.invites.query>\n    >,\n    \"queryKey\" | \"queryFn\"\n  >\n) => {\n  const { data, ...rest } = useQuery({\n    queryKey: invitesQueryKeys.list(query),\n    queryFn: async () =>\n      client.vendor.invites.query({\n        ...query,\n      }),\n    ...options,\n  })\n\n  return { ...data, ...rest }\n}\n\nexport const useCreateInvite = (\n  options?: UseMutationOptions<\n    InferClientOutput<typeof client.vendor.invites.mutate>,\n    ClientError,\n    { email: string }\n  >\n) => {\n  const queryClient = useQueryClient()\n\n  return useMutation({\n    mutationFn: async (payload) =>\n      client.vendor.invites.mutate({\n        ...payload,\n        role: \"member\",\n      }),\n    onSuccess: (data, variables, context) => {\n      queryClient.invalidateQueries({\n        queryKey: invitesQueryKeys.lists(),\n      })\n      options?.onSuccess?.(data, variables, context)\n    },\n    ...options,\n  })\n}\n\nexport const useSignUpForInvite = (\n  options?: UseMutationOptions<\n    InferClientOutput<typeof client.auth.$actorType.$authProvider.register.mutate>,\n    ClientError,\n    Omit<\n      InferClientInput<typeof client.auth.$actorType.$authProvider.register.mutate>,\n      \"$actorType\" | \"$authProvider\"\n    >\n  >\n) => {\n  return useMutation({\n    mutationFn: (payload) =>\n      client.auth.$actorType.$authProvider.register.mutate({\n        $actorType: \"seller\",\n        $authProvider: \"emailpass\",\n        ...payload,\n      }),\n    ...options,\n  })\n}\n\nexport const useAcceptInvite = (\n  inviteToken: string,\n  options?: UseMutationOptions<\n    unknown,\n    ClientError,\n    { name: string; auth_token: string }\n  >\n) => {\n  return useMutation({\n    mutationFn: async (payload) => {\n      const { auth_token, ...rest } = payload\n\n      return client.vendor.invites.accept.mutate({\n        token: inviteToken,\n        ...rest,\n        fetchOptions: {\n          headers: {\n            Authorization: `Bearer ${auth_token}`,\n          },\n        },\n      })\n    },\n    ...options,\n  })\n}\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/hooks/table/columns/use-member-table-columns.tsx",
      "content": "import { createColumnHelper } from \"@tanstack/react-table\"\nimport { useMemo } from \"react\"\nimport { Text } from \"@medusajs/ui\"\nimport type { MemberDTO } from \"../../api/members\"\n\nconst columnHelper = createColumnHelper<MemberDTO>()\n\nexport const useMemberTableColumns = () => {\n  return useMemo(\n    () => [\n      columnHelper.accessor(\"email\", {\n        header: () => (\n          <div className=\"flex h-full w-full items-center\">\n            <span className=\"truncate\">Email</span>\n          </div>\n        ),\n        cell: ({ getValue }) => {\n          const email = getValue()\n          return (\n            <Text size=\"small\" leading=\"compact\" className=\"text-ui-fg-subtle\">\n              {email || \"-\"}\n            </Text>\n          )\n        },\n      }),\n      columnHelper.accessor(\"name\", {\n        header: () => (\n          <div className=\"flex h-full w-full items-center\">\n            <span className=\"truncate\">Name</span>\n          </div>\n        ),\n        cell: ({ getValue }) => {\n          const name = getValue()\n          return (\n            <Text size=\"small\" leading=\"compact\" className=\"text-ui-fg-subtle\">\n              {name || \"-\"}\n            </Text>\n          )\n        },\n      }),\n    ],\n    []\n  )\n}\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/hooks/table/query/use-member-table-query.tsx",
      "content": "import { useQueryParams } from \"@mercurjs/dashboard-shared\"\n\ntype UseMemberTableQueryProps = {\n  prefix?: string\n  pageSize?: number\n}\n\nexport const useMemberTableQuery = ({\n  prefix,\n  pageSize = 20,\n}: UseMemberTableQueryProps) => {\n  const queryObject = useQueryParams(\n    [\"offset\", \"q\", \"order\"],\n    prefix\n  )\n\n  const { offset, q, order } = queryObject\n\n  const searchParams: Record<string, any> = {\n    limit: pageSize,\n    offset: offset ? Number(offset) : 0,\n    order: order ? order : \"-created_at\",\n    q,\n  }\n\n  return {\n    searchParams,\n    raw: queryObject,\n  }\n}\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/pages/settings/users/page.tsx",
      "content": "import { keepPreviousData } from \"@tanstack/react-query\"\nimport { Container, Heading, Button } from \"@medusajs/ui\"\nimport { Link } from \"react-router-dom\"\nimport { PlusMini, Users } from \"@medusajs/icons\"\n\nimport { _DataTable, SingleColumnPage } from \"@mercurjs/dashboard-shared\"\nimport { useDataTable } from \"@mercurjs/dashboard-shared\"\nimport { useMembers } from \"../../../hooks/api/members\"\nimport { useMemberTableColumns } from \"../../../hooks/table/columns/use-member-table-columns\"\nimport { useMemberTableQuery } from \"../../../hooks/table/query/use-member-table-query\"\n\nexport const config = {\n  label: \"Team\",\n  icon: Users,\n}\n\nconst PAGE_SIZE = 20\n\nconst UserListPage = () => {\n  const { raw, searchParams } = useMemberTableQuery({\n    pageSize: PAGE_SIZE,\n  })\n\n  const { members, count, isError, error, isLoading } = useMembers(\n    searchParams,\n    {\n      placeholderData: keepPreviousData,\n    }\n  )\n\n  const columns = useMemberTableColumns()\n\n  const { table } = useDataTable({\n    data: members ?? [],\n    columns,\n    enablePagination: true,\n    count: count,\n    pageSize: PAGE_SIZE,\n  })\n\n  if (isError) {\n    throw error\n  }\n\n  return (\n    <SingleColumnPage>\n      <Container className=\"divide-y p-0\">\n        <div className=\"flex items-center justify-between px-6 py-4\">\n          <Heading>Team Members</Heading>\n          <Link to=\"/settings/users/invite\">\n            <Button variant=\"secondary\" size=\"small\">\n              <PlusMini />\n              Invite\n            </Button>\n          </Link>\n        </div>\n        <_DataTable\n          columns={columns}\n          table={table}\n          pagination\n          search\n          navigateTo={(row) => `/settings/users/${row.original.id}`}\n          count={count}\n          isLoading={isLoading}\n          pageSize={PAGE_SIZE}\n          orderBy={[\n            {\n              key: \"name\",\n              label: \"Name\",\n            },\n            {\n              key: \"email\",\n              label: \"Email\",\n            },\n          ]}\n          queryObject={raw}\n          noRecords={{\n            message: \"No team members found\",\n          }}\n        />\n      </Container>\n    </SingleColumnPage>\n  )\n}\n\nexport default UserListPage\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/pages/settings/users/[id]/page.tsx",
      "content": "import { useParams, useNavigate } from \"react-router-dom\"\nimport { Container, Heading, Text, usePrompt } from \"@medusajs/ui\"\n\nimport {\n  SingleColumnPageSkeleton,\n  SingleColumnPage,\n  ActionMenu,\n} from \"@mercurjs/dashboard-shared\"\nimport { useMember, useDeleteMember } from \"../../../../hooks/api/members\"\nimport type { MemberDTO } from \"../../../../hooks/api/members\"\nimport { PencilSquare, Trash } from \"@medusajs/icons\"\n\nconst MemberGeneralSection = ({ member }: { member: MemberDTO }) => {\n  const navigate = useNavigate()\n  const prompt = usePrompt()\n  const { mutateAsync: deleteMember } = useDeleteMember(member.id)\n\n  const handleDelete = async () => {\n    const confirmed = await prompt({\n      title: \"Delete team member\",\n      description: \"Are you sure you want to remove this team member?\",\n      confirmText: \"Delete\",\n      cancelText: \"Cancel\",\n    })\n\n    if (confirmed) {\n      await deleteMember()\n      navigate(\"/settings/users\", { replace: true })\n    }\n  }\n\n  return (\n    <Container className=\"divide-y p-0\">\n      <div className=\"flex items-center justify-between px-6 py-4\">\n        <Heading>{member.email || member.name}</Heading>\n        <ActionMenu\n          groups={[\n            {\n              actions: [\n                {\n                  label: \"Edit\",\n                  icon: <PencilSquare />,\n                  to: `/settings/users/${member.id}/edit`,\n                },\n              ],\n            },\n            {\n              actions: [\n                {\n                  label: \"Delete\",\n                  icon: <Trash />,\n                  onClick: handleDelete,\n                },\n              ],\n            },\n          ]}\n        />\n      </div>\n      <div className=\"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4\">\n        <Text size=\"small\" leading=\"compact\" weight=\"plus\">\n          Name\n        </Text>\n        <Text size=\"small\" leading=\"compact\">\n          {member.name || \"-\"}\n        </Text>\n      </div>\n      <div className=\"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4\">\n        <Text size=\"small\" leading=\"compact\" weight=\"plus\">\n          Role\n        </Text>\n        <Text size=\"small\" leading=\"compact\">\n          {member.role.charAt(0).toUpperCase() + member.role.slice(1)}\n        </Text>\n      </div>\n      <div className=\"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4\">\n        <Text size=\"small\" leading=\"compact\" weight=\"plus\">\n          Email\n        </Text>\n        <Text size=\"small\" leading=\"compact\">\n          {member.email || \"-\"}\n        </Text>\n      </div>\n      <div className=\"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4\">\n        <Text size=\"small\" leading=\"compact\" weight=\"plus\">\n          Phone\n        </Text>\n        <Text size=\"small\" leading=\"compact\">\n          {member.phone || \"-\"}\n        </Text>\n      </div>\n    </Container>\n  )\n}\n\nconst UserDetailPage = () => {\n  const { id } = useParams()\n\n  const { member, isLoading, isError, error } = useMember(id!)\n\n  if (isLoading || !member) {\n    return <SingleColumnPageSkeleton sections={1} />\n  }\n\n  if (isError) {\n    throw error\n  }\n\n  return (\n    <SingleColumnPage>\n      <MemberGeneralSection member={member} />\n    </SingleColumnPage>\n  )\n}\n\nexport default UserDetailPage\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/pages/settings/users/[id]/breadcrumb.tsx",
      "content": "import type { UIMatch } from \"react-router-dom\"\n\nimport { useMember } from \"../../../../hooks/api/members\"\n\nexport const Breadcrumb = (props: UIMatch) => {\n  const { id } = props.params || {}\n\n  const { member } = useMember(id!, undefined, {\n    enabled: Boolean(id),\n  })\n\n  if (!member) {\n    return null\n  }\n\n  return <span>{member.name || member.email || member.id}</span>\n}\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/pages/settings/users/[id]/edit/page.tsx",
      "content": "import { useParams } from \"react-router-dom\"\nimport { useForm } from \"react-hook-form\"\nimport { zodResolver } from \"@hookform/resolvers/zod\"\nimport { z } from \"zod\"\nimport { Button, Input } from \"@medusajs/ui\"\n\nimport { RouteDrawer, useRouteModal } from \"@mercurjs/dashboard-shared\"\nimport { useMember, useUpdateMember } from \"../../../../../hooks/api/members\"\n\nconst EditMemberSchema = z.object({\n  name: z.string().min(1, \"Name is required\"),\n})\n\ntype EditMemberFormValues = z.infer<typeof EditMemberSchema>\n\nconst EditMemberForm = ({\n  member,\n}: {\n  member: { id: string; name: string }\n}) => {\n  const { handleSuccess } = useRouteModal()\n  const { mutateAsync: updateMember, isPending } = useUpdateMember(member.id)\n\n  const form = useForm<EditMemberFormValues>({\n    resolver: zodResolver(EditMemberSchema),\n    defaultValues: {\n      name: member.name || \"\",\n    },\n  })\n\n  const handleSubmit = form.handleSubmit(async (values) => {\n    await updateMember(values)\n    handleSuccess()\n  })\n\n  return (\n    <form onSubmit={handleSubmit} className=\"flex flex-1 flex-col\">\n      <RouteDrawer.Body>\n        <div className=\"flex flex-col gap-y-4\">\n          <div className=\"flex flex-col gap-y-2\">\n            <label htmlFor=\"name\" className=\"text-ui-fg-subtle txt-small\">\n              Name\n            </label>\n            <Input id=\"name\" {...form.register(\"name\")} />\n            {form.formState.errors.name && (\n              <span className=\"text-ui-fg-error txt-small\">\n                {form.formState.errors.name.message}\n              </span>\n            )}\n          </div>\n        </div>\n      </RouteDrawer.Body>\n      <RouteDrawer.Footer>\n        <div className=\"flex items-center justify-end gap-x-2\">\n          <RouteDrawer.Close asChild>\n            <Button variant=\"secondary\" size=\"small\">\n              Cancel\n            </Button>\n          </RouteDrawer.Close>\n          <Button\n            type=\"submit\"\n            size=\"small\"\n            isLoading={isPending}\n          >\n            Save\n          </Button>\n        </div>\n      </RouteDrawer.Footer>\n    </form>\n  )\n}\n\nconst EditUserPage = () => {\n  const { id } = useParams()\n  const { member, isLoading } = useMember(id!)\n\n  return (\n    <RouteDrawer>\n      <RouteDrawer.Header>\n        <RouteDrawer.Title>Edit Team Member</RouteDrawer.Title>\n      </RouteDrawer.Header>\n      {!isLoading && member && <EditMemberForm member={member} />}\n    </RouteDrawer>\n  )\n}\n\nexport default EditUserPage\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/pages/settings/users/invite/page.tsx",
      "content": "import { useForm } from \"react-hook-form\"\nimport { zodResolver } from \"@hookform/resolvers/zod\"\nimport { z } from \"zod\"\nimport { Button, Input, StatusBadge, Text, toast } from \"@medusajs/ui\"\n\nimport { RouteDrawer } from \"@mercurjs/dashboard-shared\"\nimport { useCreateInvite, useInvites } from \"../../../../hooks/api/invites\"\n\nconst InviteSchema = z.object({\n  email: z.string().email(\"Please enter a valid email address\"),\n})\n\ntype InviteFormValues = z.infer<typeof InviteSchema>\n\nconst InviteUserPage = () => {\n  const { mutateAsync: createInvite, isPending } = useCreateInvite()\n  const { invites } = useInvites()\n\n  const form = useForm<InviteFormValues>({\n    resolver: zodResolver(InviteSchema),\n    defaultValues: {\n      email: \"\",\n    },\n  })\n\n  const handleSubmit = form.handleSubmit(async (values) => {\n    try {\n      await createInvite({ email: values.email })\n      form.reset()\n      toast.success(\"Invitation sent successfully\")\n    } catch (e: any) {\n      toast.error(e?.message || \"Failed to send invitation\")\n    }\n  })\n\n  const getStatusBadge = (invite: any) => {\n    if (invite.accepted) {\n      return <StatusBadge color=\"green\">Accepted</StatusBadge>\n    }\n    if (new Date(invite.expires_at) < new Date()) {\n      return <StatusBadge color=\"red\">Expired</StatusBadge>\n    }\n    return <StatusBadge color=\"orange\">Pending</StatusBadge>\n  }\n\n  return (\n    <RouteDrawer>\n      <RouteDrawer.Header>\n        <RouteDrawer.Title>Invite Team Member</RouteDrawer.Title>\n      </RouteDrawer.Header>\n      <RouteDrawer.Body>\n        <form onSubmit={handleSubmit} className=\"flex flex-col gap-y-6\">\n          <div className=\"flex gap-x-2\">\n            <div className=\"flex-1\">\n              <Input\n                placeholder=\"member@example.com\"\n                {...form.register(\"email\")}\n              />\n              {form.formState.errors.email && (\n                <span className=\"text-ui-fg-error txt-small mt-1\">\n                  {form.formState.errors.email.message}\n                </span>\n              )}\n            </div>\n            <Button\n              type=\"submit\"\n              variant=\"secondary\"\n              size=\"small\"\n              isLoading={isPending}\n            >\n              Send Invite\n            </Button>\n          </div>\n\n          {invites && invites.length > 0 && (\n            <div className=\"flex flex-col gap-y-2\">\n              <Text size=\"small\" weight=\"plus\" className=\"text-ui-fg-subtle\">\n                Pending Invitations\n              </Text>\n              <div className=\"divide-y rounded-lg border\">\n                {invites.map((invite: any) => (\n                  <div\n                    key={invite.id}\n                    className=\"flex items-center justify-between px-4 py-3\"\n                  >\n                    <Text size=\"small\" className=\"text-ui-fg-subtle\">\n                      {invite.email}\n                    </Text>\n                    {getStatusBadge(invite)}\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n        </form>\n      </RouteDrawer.Body>\n      <RouteDrawer.Footer>\n        <div className=\"flex items-center justify-end\">\n          <RouteDrawer.Close asChild>\n            <Button variant=\"secondary\" size=\"small\">\n              Close\n            </Button>\n          </RouteDrawer.Close>\n        </div>\n      </RouteDrawer.Footer>\n    </RouteDrawer>\n  )\n}\n\nexport default InviteUserPage\n",
      "type": "registry:vendor"
    },
    {
      "path": "team-management/vendor/pages/invite/page.tsx",
      "content": "import { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Alert, Button, Heading, Hint, Input, Text } from \"@medusajs/ui\";\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { decodeToken } from \"react-jwt\";\nimport { Link, useSearchParams } from \"react-router-dom\";\nimport { z } from \"zod\";\n\nimport { useSignUpForInvite, useAcceptInvite } from \"../../hooks/api/invites\";\n\nexport const config = {\n  public: true,\n};\n\nconst CreateAccountSchema = z\n  .object({\n    email: z.string().email(),\n    first_name: z.string().min(1, \"First name is required\"),\n    last_name: z.string().min(1, \"Last name is required\"),\n    password: z.string().min(1, \"Password is required\"),\n    repeat_password: z.string().min(1, \"Please repeat password\"),\n  })\n  .superRefine(({ password, repeat_password }, ctx) => {\n    if (password !== repeat_password) {\n      ctx.addIssue({\n        code: z.ZodIssueCode.custom,\n        message: \"Passwords do not match\",\n        path: [\"repeat_password\"],\n      });\n    }\n  });\n\ntype DecodedInvite = {\n  id: string;\n  exp: number;\n  iat: number;\n};\n\nconst InviteSchema = z.object({\n  id: z.string(),\n  exp: z.number(),\n  iat: z.number(),\n});\n\nconst validateDecodedInvite = (decoded: unknown): decoded is DecodedInvite => {\n  return InviteSchema.safeParse(decoded).success;\n};\n\nconst InviteAcceptPage = () => {\n  const [searchParams] = useSearchParams();\n  const [success, setSuccess] = useState(false);\n\n  const token = searchParams.get(\"token\") || null;\n  const invite: DecodedInvite | null = token ? decodeToken(token) : null;\n  const isValidInvite = invite && validateDecodedInvite(invite);\n\n  return (\n    <div className=\"bg-ui-bg-subtle relative flex min-h-dvh w-dvw items-center justify-center p-4\">\n      <div className=\"flex w-full max-w-[360px] flex-col items-center\">\n        {isValidInvite ? (\n          !success ? (\n            <CreateView onSuccess={() => setSuccess(true)} token={token!} />\n          ) : (\n            <SuccessView />\n          )\n        ) : (\n          <InvalidView />\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst LoginLink = () => (\n  <div className=\"flex w-full flex-col items-center\">\n    <div className=\"my-6 h-px w-full border-b border-dotted\" />\n    <Link\n      to=\"/login\"\n      className=\"txt-small text-ui-fg-base transition-fg hover:text-ui-fg-base-hover font-medium outline-none\"\n    >\n      Back to login\n    </Link>\n  </div>\n);\n\nconst InvalidView = () => (\n  <div className=\"flex flex-col items-center\">\n    <div className=\"flex flex-col items-center gap-y-1\">\n      <Heading>Invalid invite</Heading>\n      <Text size=\"small\" className=\"text-ui-fg-subtle text-center\">\n        The invite link is invalid or has expired. Please request a new invite.\n      </Text>\n    </div>\n    <LoginLink />\n  </div>\n);\n\nconst CreateView = ({\n  onSuccess,\n  token,\n}: {\n  onSuccess: () => void;\n  token: string;\n}) => {\n  const [invalid, setInvalid] = useState(false);\n\n  const form = useForm<z.infer<typeof CreateAccountSchema>>({\n    resolver: zodResolver(CreateAccountSchema),\n    defaultValues: {\n      email: \"\",\n      first_name: \"\",\n      last_name: \"\",\n      password: \"\",\n      repeat_password: \"\",\n    },\n  });\n\n  const { mutateAsync: signUp, isPending: isCreating } = useSignUpForInvite();\n  const { mutateAsync: acceptInvite, isPending: isAccepting } =\n    useAcceptInvite(token);\n\n  const handleSubmit = form.handleSubmit(async (data) => {\n    try {\n      const authToken = await signUp({\n        email: data.email,\n        password: data.password,\n      });\n\n      await acceptInvite({\n        name: `${data.first_name} ${data.last_name}`,\n        auth_token: authToken as string,\n      });\n\n      onSuccess();\n    } catch (error: any) {\n      if (error?.status === 400) {\n        form.setError(\"root\", {\n          type: \"manual\",\n          message: \"This invite is no longer valid.\",\n        });\n        setInvalid(true);\n        return;\n      }\n      form.setError(\"root\", {\n        type: \"manual\",\n        message: error.message || \"Something went wrong\",\n      });\n    }\n  });\n\n  const serverError = form.formState.errors.root?.message;\n  const validationError =\n    form.formState.errors.email?.message ||\n    form.formState.errors.first_name?.message ||\n    form.formState.errors.last_name?.message ||\n    form.formState.errors.password?.message ||\n    form.formState.errors.repeat_password?.message;\n\n  return (\n    <div className=\"flex w-full flex-col items-center\">\n      <div className=\"mb-4 flex flex-col items-center\">\n        <Heading>Create your account</Heading>\n        <Text size=\"small\" className=\"text-ui-fg-subtle text-center\">\n          Enter your details to accept the invitation and join the team.\n        </Text>\n      </div>\n      <form onSubmit={handleSubmit} className=\"flex w-full flex-col gap-y-6\">\n        <div className=\"flex flex-col gap-y-2\">\n          <Input\n            autoComplete=\"off\"\n            placeholder=\"Email\"\n            className=\"bg-ui-bg-field-component\"\n            {...form.register(\"email\")}\n          />\n          <Input\n            autoComplete=\"given-name\"\n            placeholder=\"First name\"\n            className=\"bg-ui-bg-field-component\"\n            {...form.register(\"first_name\")}\n          />\n          <Input\n            autoComplete=\"family-name\"\n            placeholder=\"Last name\"\n            className=\"bg-ui-bg-field-component\"\n            {...form.register(\"last_name\")}\n          />\n          <Input\n            autoComplete=\"new-password\"\n            type=\"password\"\n            placeholder=\"Password\"\n            className=\"bg-ui-bg-field-component\"\n            {...form.register(\"password\")}\n          />\n          <Input\n            autoComplete=\"off\"\n            type=\"password\"\n            placeholder=\"Repeat password\"\n            className=\"bg-ui-bg-field-component\"\n            {...form.register(\"repeat_password\")}\n          />\n          {validationError && (\n            <div className=\"mt-2 text-center\">\n              <Hint variant=\"error\">{validationError}</Hint>\n            </div>\n          )}\n          {serverError && (\n            <Alert\n              className=\"bg-ui-bg-base items-center p-2\"\n              dismissible\n              variant=\"error\"\n            >\n              {serverError}\n            </Alert>\n          )}\n        </div>\n        <Button\n          className=\"w-full\"\n          type=\"submit\"\n          isLoading={isCreating || isAccepting}\n          disabled={invalid}\n        >\n          Create account\n        </Button>\n      </form>\n      <LoginLink />\n    </div>\n  );\n};\n\nconst SuccessView = () => (\n  <div className=\"flex w-full flex-col items-center gap-y-6\">\n    <div className=\"flex flex-col items-center gap-y-1\">\n      <Heading className=\"text-center\">Account created!</Heading>\n      <Text size=\"small\" className=\"text-ui-fg-subtle text-center\">\n        Your account has been created. You can now log in.\n      </Text>\n    </div>\n    <Button variant=\"secondary\" asChild className=\"w-full\">\n      <Link to=\"/login\" replace>\n        Go to login\n      </Link>\n    </Button>\n  </div>\n);\n\nexport default InviteAcceptPage;\n",
      "type": "registry:vendor"
    }
  ]
}