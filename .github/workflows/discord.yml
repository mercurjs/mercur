name: Discord Notifications

on:
  pull_request:
    types: [opened, closed, reopened]
  issues:
    types: [opened, reopened]
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Build message
        id: msg
        run: |
          EVENT="${{ github.event_name }}"
          ACTION="${{ github.event.action }}"
          REPO="${{ github.repository }}"
          URL=""
          TITLE=""
          CONTENT=""

          if [ "$EVENT" = "pull_request" ]; then
            TITLE="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            PRNUM="${{ github.event.pull_request.number }}"
            MERGED="${{ github.event.pull_request.merged }}"
            if [ "$ACTION" = "closed" ] && [ "$MERGED" = "true" ]; then
              CONTENT="‚úÖ **PR merged** #$PRNUM: $TITLE\n$URL"
            else
              CONTENT="üîÅ **PR $ACTION** #$PRNUM: $TITLE\n$URL"
            fi
          elif [ "$EVENT" = "issues" ]; then
            TITLE="${{ github.event.issue.title }}"
            URL="${{ github.event.issue.html_url }}"
            INUM="${{ github.event.issue.number }}"
            CONTENT="üêõ **Issue $ACTION** #$INUM: $TITLE\n$URL"
          elif [ "$EVENT" = "release" ]; then
            TITLE="${{ github.event.release.name }}"
            URL="${{ github.event.release.html_url }}"
            TAG="${{ github.event.release.tag_name }}"
            CONTENT="üöÄ **Release published**: **$TAG** ‚Äî $TITLE\n$URL"
          else
            CONTENT="‚ÑπÔ∏è Event: $EVENT ($ACTION)"
          fi

          echo "content<<EOF" >> $GITHUB_OUTPUT
          echo "$CONTENT" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT

      - name: Send to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          CONTENT: ${{ steps.msg.outputs.content }}
        run: |
          curl -H "Content-Type: application/json" \
               -d "{\"content\": \"$CONTENT\"}" \
               "$DISCORD_WEBHOOK_URL"
