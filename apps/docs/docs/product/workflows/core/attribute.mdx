---
title: "Attribute Workflows"
description: "Reference documentation for the Attribute Module workflows and steps"
---

# Workflows

## createAttributePossibleValuesWorkflow

This documentation provides a reference to the `createAttributePossibleValuesWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow creates one or more possible values for an attribute.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/create-attribute-possible-values.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/admin/attributes/[id]/values/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { createAttributePossibleValuesWorkflow } from "../../../../../workflows/attribute/workflows/create-attribute-possible-values";
    import { CreateAttributeValueDTO } from "@mercurjs/framework";
    
    export const POST = async (
      req: AuthenticatedMedusaRequest<Omit<CreateAttributeValueDTO, 'attribute_id'>>,
      res: MedusaResponse
    ) => {
      const attributeId = req.params.id;
    
      const { result } = await createAttributePossibleValuesWorkflow(req.scope).run({
        input: [
          {
            ...req.validatedBody,
            attribute_id: attributeId,
          },
        ],
      });
    
      res.json({ attribute_value: result[0] });
    };
    ```
  </Tab>
</Tabs>

### Steps

- [createAttributePossibleValuesStep](#createattributepossiblevaluesstep): This step creates one or more attribute possible values.

### Input

<ParamField body="input" type="CreateAttributeValueDTO[]" required>
  The list of attribute values to create.

  <Expandable title="properties">
    <ParamField body="value" type="string" required>
      The value of the attribute option (e.g. "Red", "XL").
    </ParamField>
    <ParamField body="rank" type="number" required>
      The rank or order of the value used for sorting.
    </ParamField>
    <ParamField body="attribute_id" type="string" required>
      The ID of the attribute this value belongs to.
    </ParamField>
    <ParamField body="metadata" type="Record<string, unknown>">
      Holds custom data in key-value pairs.
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="AttributePossibleValueDTO[]" type="AttributePossibleValueDTO[]">
  The created attribute possible values.

  <Expandable title="properties">
    <ResponseField name="id" type="string">
      The ID of the attribute value.
    </ResponseField>
    <ResponseField name="value" type="string">
      The value of the attribute option.
    </ResponseField>
    <ResponseField name="rank" type="number">
      The rank of the value.
    </ResponseField>
    <ResponseField name="attribute_id" type="string">
      The ID of the parent attribute.
    </ResponseField>
    <ResponseField name="metadata" type="Record<string, unknown>">
      Holds custom data in key-value pairs.
    </ResponseField>
  </Expandable>
</ResponseField>

---

## createAttributeValueWorkflow

This documentation provides a reference to the `createAttributeValueWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow creates an attribute value for a product and links it to the product. It handles the creation of the attribute value and the remote link between the product and the attribute value. It also includes validation to ensure the value is allowed for the attribute and that the product is associated with the attribute's categories.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/create-attribute-value.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/vendor/products/[id]/options/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { createAttributeValueWorkflow } from "../../../../../workflows/attribute/workflows/create-attribute-value";
    import { CreateProductAttributeValueDTO } from "@mercurjs/framework";
    
    export const POST = async (
      req: AuthenticatedMedusaRequest<Omit<CreateProductAttributeValueDTO, 'product_id'>>,
      res: MedusaResponse
    ) => {
      const productId = req.params.id;
    
      const { result } = await createAttributeValueWorkflow(req.scope).run({
        input: {
          ...req.validatedBody,
          product_id: productId,
        },
      });
    
      res.json({ attribute_value: result });
    };
    ```
  </Tab>
  <Tab title="Another Workflow">
    ```ts packages/modules/b2c-core/src/workflows/attribute/utils/products-created-handler.ts
    import { createAttributeValueWorkflow } from "../workflows/create-attribute-value";
    
    // ... inside productsCreatedHandler
    
    await createAttributeValueWorkflow(container).run({
      input: {
        attribute_id: attributeId,
        product_id: product.id,
        value: attributeValue,
      },
    });
    ```
  </Tab>
</Tabs>

### Steps

- [validateAttributeValueStep](#validateattributevaluestep): Validates that the value is allowed for the attribute and the product is compatible.
- [createAttributeValueStep](#createattributevaluestep): Creates the attribute value record.
- **createRemoteLinkStep**: Links the created attribute value to the product.

### Input

<ParamField body="input" type="CreateProductAttributeValueDTO" required>
  The details of the attribute value to create and link.

  <Expandable title="properties">
    <ParamField body="attribute_id" type="string" required>
      The ID of the attribute.
    </ParamField>
    <ParamField body="product_id" type="string" required>
      The ID of the product to assign the value to.
    </ParamField>
    <ParamField body="value" type="string" required>
      The value to assign (must be one of the possible values if defined).
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="AttributeValueDTO" type="AttributeValueDTO">
  The created attribute value.

  <Expandable title="properties">
    <ResponseField name="id" type="string">
      The ID of the attribute value.
    </ResponseField>
    <ResponseField name="value" type="string">
      The assigned value.
    </ResponseField>
    <ResponseField name="attribute_id" type="string">
      The ID of the attribute.
    </ResponseField>
  </Expandable>
</ResponseField>

---

## createAttributesWorkflow

This documentation provides a reference to the `createAttributesWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow creates one or more attributes and optionally links them to product categories.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/create-attributes.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/admin/attributes/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { createAttributesWorkflow } from "../../../workflows/attribute/workflows/create-attributes";
    import { CreateAttributeDTO } from "@mercurjs/framework";
    
    export const POST = async (
      req: AuthenticatedMedusaRequest<CreateAttributeDTO>,
      res: MedusaResponse
    ) => {
      const { result } = await createAttributesWorkflow(req.scope).run({
        input: {
          attributes: [
            {
              ...req.validatedBody,
              product_category_ids: req.validatedBody.product_category_ids,
            },
          ],
        },
      });
    
      res.json({ attribute: result[0] });
    };
    ```
  </Tab>
</Tabs>

### Steps

- [createAttributesStep](#createattributesstep): Creates the attributes.
- **createRemoteLinkStep**: Links the created attributes to the specified product categories.

### Input

<ParamField body="input" type="object" required>
  <Expandable title="properties">
    <ParamField body="attributes" type="CreateAttributeDTO[]" required>
      The list of attributes to create.

      <Expandable title="properties">
        <ParamField body="name" type="string" required>
          The name of the attribute.
        </ParamField>
        <ParamField body="ui_component" type="string" required>
          The UI component type (e.g., 'select', 'text').
        </ParamField>
        <ParamField body="description" type="string">
          The description of the attribute.
        </ParamField>
        <ParamField body="handle" type="string">
          The handle for the attribute. Defaults to slugified name.
        </ParamField>
        <ParamField body="is_filterable" type="boolean">
          Whether the attribute can be used for filtering.
        </ParamField>
        <ParamField body="is_required" type="boolean">
          Whether the attribute is required.
        </ParamField>
        <ParamField body="product_category_ids" type="string[]">
          List of product category IDs to link this attribute to.
        </ParamField>
        <ParamField body="possible_values" type="CreateAttributeValueDTO[]">
          List of possible values for this attribute.
        </ParamField>
      </Expandable>
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="AttributeDTO[]" type="AttributeDTO[]">
  The created attributes.

  <Expandable title="properties">
    <ResponseField name="id" type="string">
      The ID of the attribute.
    </ResponseField>
    <ResponseField name="name" type="string">
      The name of the attribute.
    </ResponseField>
    <ResponseField name="handle" type="string">
      The handle of the attribute.
    </ResponseField>
  </Expandable>
</ResponseField>

---

## deleteAttributeValueWorkflow

This documentation provides a reference to the `deleteAttributeValueWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow deletes one or more attribute values (the actual assigned values to products, not the definition possible values) and cleans up the links to products.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/delete-attribute-value.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/vendor/products/[id]/options/[option_id]/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { deleteAttributeValueWorkflow } from "../../../../../../workflows/attribute/workflows/delete-attribute-value";
    
    export const DELETE = async (
      req: AuthenticatedMedusaRequest,
      res: MedusaResponse
    ) => {
      const optionId = req.params.option_id;
    
      await deleteAttributeValueWorkflow(req.scope).run({
        input: optionId,
      });
    
      res.status(200).json({
        id: optionId,
        object: "attribute_value",
        deleted: true,
      });
    };
    ```
  </Tab>
</Tabs>

### Steps

- **useQueryGraphStep**: Fetches the links between the attribute values and products to be dismissed.
- [deleteAttributeValueStep](#deleteattributevaluestep): Soft deletes the attribute values.
- **dismissRemoteLinkStep**: Removes the links between the attribute values and products.

### Input

<ParamField body="input" type="string | string[]" required>
  The ID or IDs of the attribute values to delete.
</ParamField>

### Output

<ResponseField name="string[]" type="string[]">
  The IDs of the deleted attribute values.
</ResponseField>

---

## deleteAttributeWorkflow

This documentation provides a reference to the `deleteAttributeWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow deletes an attribute definition.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/delete-attribute.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/admin/attributes/[id]/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { deleteAttributeWorkflow } from "../../../../workflows/attribute/workflows/delete-attribute";
    
    export const DELETE = async (
      req: AuthenticatedMedusaRequest,
      res: MedusaResponse
    ) => {
      const attributeId = req.params.id;
    
      await deleteAttributeWorkflow(req.scope).run({
        input: {
          id: attributeId,
        },
      });
    
      res.status(200).json({
        id: attributeId,
        object: "attribute",
        deleted: true,
      });
    };
    ```
  </Tab>
</Tabs>

### Steps

- [deleteAttributeStep](#deleteattributestep): Deletes the attribute and its associated links.

### Input

<ParamField body="input" type="object" required>
  <Expandable title="properties">
    <ParamField body="id" type="string" required>
      The ID of the attribute to delete.
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="void" type="void">
  The workflow does not return a value.
</ResponseField>

---

## updateAttributePossibleValueWorkflow

This documentation provides a reference to the `updateAttributePossibleValueWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow updates a possible value definition of an attribute (e.g., changing "Blue" to "Navy").

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/update-attribute-possible-value.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/admin/attributes/[id]/values/[value_id]/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { updateAttributePossibleValueWorkflow } from "../../../../../../workflows/attribute/workflows/update-attribute-possible-value";
    import { UpdateAttributeValueDTO } from "@mercurjs/framework";
    
    export const POST = async (
      req: AuthenticatedMedusaRequest<UpdateAttributeValueDTO>,
      res: MedusaResponse
    ) => {
      const valueId = req.params.value_id;
    
      const { result } = await updateAttributePossibleValueWorkflow(req.scope).run({
        input: {
          ...req.validatedBody,
          id: valueId,
        },
      });
    
      res.json({ attribute_value: result });
    };
    ```
  </Tab>
</Tabs>

### Steps

- [updateAttributePossibleValueStep](#updateattributepossiblevaluestep): Updates the attribute possible value.

### Input

<ParamField body="input" type="UpdateAttributeValueDTO" required>
  The details to update.

  <Expandable title="properties">
    <ParamField body="id" type="string" required>
      The ID of the possible value to update.
    </ParamField>
    <ParamField body="value" type="string">
      The new value.
    </ParamField>
    <ParamField body="rank" type="number">
      The new rank.
    </ParamField>
    <ParamField body="metadata" type="Record<string, unknown>">
      New metadata.
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="AttributePossibleValueDTO" type="AttributePossibleValueDTO">
  The updated attribute possible value.
</ResponseField>

---

## updateAttributesWorkflow

This documentation provides a reference to the `updateAttributesWorkflow`. It belongs to the `@mercurjs/b2c-core` package.

This workflow updates one or more attributes, including their details, possible values, and category associations.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/workflows/update-attributes.ts)

### Examples

<Tabs>
  <Tab title="API Route">
    ```ts packages/modules/b2c-core/src/api/admin/attributes/[id]/route.ts
    import { AuthenticatedMedusaRequest, MedusaResponse } from "@medusajs/framework";
    import { updateAttributesWorkflow } from "../../../../workflows/attribute/workflows/update-attributes";
    import { AdminUpdateAttributeType } from "../../validators";
    
    export const POST = async (
      req: AuthenticatedMedusaRequest<AdminUpdateAttributeType>,
      res: MedusaResponse
    ) => {
      const attributeId = req.params.id;
    
      await updateAttributesWorkflow(req.scope).run({
        input: {
          attributes: [
            {
              ...req.validatedBody,
              id: attributeId,
              product_category_ids:
                req.validatedBody.product_category_ids?.map((id) => ({ id })) ||
                undefined,
            },
          ],
        },
      });
    
      // ... fetch and return updated attribute
    };
    ```
  </Tab>
</Tabs>

### Steps

- [updateAttributesStep](#updateattributesstep): Updates the attributes and their possible values.
- **useQueryGraphStep**: Fetches current category links to determine what to add or remove.
- **dismissRemoteLinkStep**: Removes links to categories that are no longer associated.
- **createRemoteLinkStep**: Creates links to newly associated categories.

### Input

<ParamField body="input" type="object" required>
  <Expandable title="properties">
    <ParamField body="attributes" type="UpdateAttributeDTO[]" required>
      The list of attributes to update.

      <Expandable title="properties">
        <ParamField body="id" type="string" required>
          The ID of the attribute.
        </ParamField>
        <ParamField body="name" type="string">
          The new name.
        </ParamField>
        <ParamField body="product_category_ids" type="string[]">
          The new list of product category IDs. Replaces existing links.
        </ParamField>
        <ParamField body="possible_values" type="CreateAttributeValueDTO[]">
          The new list of possible values. This handles upsert/replace logic.
        </ParamField>
      </Expandable>
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="AttributeDTO[]" type="AttributeDTO[]">
  The updated attributes.
</ResponseField>

---

# Steps

## createAttributePossibleValuesStep

Creates one or more attribute possible values.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/create-attribute-possible-values.ts)

### Input

<ParamField body="data" type="CreateAttributeValueDTO[]" required>
  List of values to create.
</ParamField>

### Output

<ResponseField name="AttributePossibleValueDTO[]" type="AttributePossibleValueDTO[]">
  The created values.
</ResponseField>

---

## createAttributeValueStep

Creates an attribute value (assigned value).

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/create-attribute-value.ts)

### Input

<ParamField body="input" type="Omit<CreateProductAttributeValueDTO, 'product_id'>" required>
  The value data (excluding product ID which is linked separately).
</ParamField>

### Output

<ResponseField name="AttributeValueDTO" type="AttributeValueDTO">
  The created value.
</ResponseField>

---

## createAttributesStep

Creates one or more attributes. It validates that no attribute with the same name exists.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/create-attributes.ts)

### Input

<ParamField body="data" type="Omit<CreateAttributeDTO, 'product_category_ids'>[]" required>
  List of attributes to create.
</ParamField>

### Output

<ResponseField name="AttributeDTO[]" type="AttributeDTO[]">
  The created attributes.
</ResponseField>

---

## deleteAttributeValueStep

Soft deletes attribute values.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/delete-attribute-value.ts)

### Input

<ParamField body="ids" type="string[]" required>
  IDs of the values to delete.
</ParamField>

### Output

<ResponseField name="string[]" type="string[]">
  The IDs of deleted values.
</ResponseField>

---

## deleteAttributeStep

Soft deletes an attribute and removes its links.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/delete-attribute.ts)

### Input

<ParamField body="input" type="object" required>
  <Expandable title="properties">
    <ParamField body="id" type="string" required>
      ID of the attribute to delete.
    </ParamField>
  </Expandable>
</ParamField>

### Output

<ResponseField name="void" type="void">
  No return value.
</ResponseField>

---

## updateAttributePossibleValueStep

Updates a single attribute possible value.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/update-attribute-possible-value.ts)

### Input

<ParamField body="payload" type="UpdateAttributeValueDTO" required>
  The update data.
</ParamField>

### Output

<ResponseField name="AttributePossibleValueDTO" type="AttributePossibleValueDTO">
  The updated value.
</ResponseField>

---

## updateAttributesStep

Updates attributes and their possible values. Uses upsert/replace logic for values.

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/update-attributes.ts)

### Input

<ParamField body="data" type="UpdateAttributeDTO[]" required>
  List of attributes to update.
</ParamField>

### Output

<ResponseField name="AttributeDTO[]" type="AttributeDTO[]">
  The updated attributes.
</ResponseField>

---

## validateAttributeValueStep

Validates that a value is allowed for a given attribute and product. It checks:

1. If the value is in the attribute's `possible_values` (if restricted).
2. If the product belongs to a category allowed by the attribute.
3. If the product already has a value for this attribute (duplicate check).

[Source code](https://github.com/mercurjs/mercur/blob/main/packages/modules/b2c-core/src/workflows/attribute/steps/validate-attribute-value.ts)

### Input

<ParamField body="input" type="CreateProductAttributeValueDTO" required>
  The value creation payload to validate.
</ParamField>

### Output

<ResponseField name="void" type="void">
  Throws an error if validation fails.
</ResponseField>